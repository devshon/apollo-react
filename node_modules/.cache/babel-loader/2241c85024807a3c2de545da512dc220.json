{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar iterall_1 = require(\"iterall\");\n\nfunction eventEmitterAsyncIterator(eventEmitter, eventsNames) {\n  var pullQueue = [];\n  var pushQueue = [];\n  var eventsArray = typeof eventsNames === 'string' ? [eventsNames] : eventsNames;\n  var listening = true;\n\n  var pushValue = function (event) {\n    if (pullQueue.length !== 0) {\n      pullQueue.shift()({\n        value: event,\n        done: false\n      });\n    } else {\n      pushQueue.push(event);\n    }\n  };\n\n  var pullValue = function () {\n    return new Promise(function (resolve) {\n      if (pushQueue.length !== 0) {\n        resolve({\n          value: pushQueue.shift(),\n          done: false\n        });\n      } else {\n        pullQueue.push(resolve);\n      }\n    });\n  };\n\n  var emptyQueue = function () {\n    if (listening) {\n      listening = false;\n      removeEventListeners();\n      pullQueue.forEach(function (resolve) {\n        return resolve({\n          value: undefined,\n          done: true\n        });\n      });\n      pullQueue.length = 0;\n      pushQueue.length = 0;\n    }\n  };\n\n  var addEventListeners = function () {\n    for (var _i = 0, eventsArray_1 = eventsArray; _i < eventsArray_1.length; _i++) {\n      var eventName = eventsArray_1[_i];\n      eventEmitter.addListener(eventName, pushValue);\n    }\n  };\n\n  var removeEventListeners = function () {\n    for (var _i = 0, eventsArray_2 = eventsArray; _i < eventsArray_2.length; _i++) {\n      var eventName = eventsArray_2[_i];\n      eventEmitter.removeListener(eventName, pushValue);\n    }\n  };\n\n  addEventListeners();\n  return _a = {\n    next: function () {\n      return listening ? pullValue() : this.return();\n    },\n    return: function () {\n      emptyQueue();\n      return Promise.resolve({\n        value: undefined,\n        done: true\n      });\n    },\n    throw: function (error) {\n      emptyQueue();\n      return Promise.reject(error);\n    }\n  }, _a[iterall_1.$$asyncIterator] = function () {\n    return this;\n  }, _a;\n\n  var _a;\n}\n\nexports.eventEmitterAsyncIterator = eventEmitterAsyncIterator;","map":{"version":3,"sources":["../src/event-emitter-to-async-iterator.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar iterall_1 = require(\"iterall\");\nfunction eventEmitterAsyncIterator(eventEmitter, eventsNames) {\n    var pullQueue = [];\n    var pushQueue = [];\n    var eventsArray = typeof eventsNames === 'string' ? [eventsNames] : eventsNames;\n    var listening = true;\n    var pushValue = function (event) {\n        if (pullQueue.length !== 0) {\n            pullQueue.shift()({ value: event, done: false });\n        }\n        else {\n            pushQueue.push(event);\n        }\n    };\n    var pullValue = function () {\n        return new Promise(function (resolve) {\n            if (pushQueue.length !== 0) {\n                resolve({ value: pushQueue.shift(), done: false });\n            }\n            else {\n                pullQueue.push(resolve);\n            }\n        });\n    };\n    var emptyQueue = function () {\n        if (listening) {\n            listening = false;\n            removeEventListeners();\n            pullQueue.forEach(function (resolve) { return resolve({ value: undefined, done: true }); });\n            pullQueue.length = 0;\n            pushQueue.length = 0;\n        }\n    };\n    var addEventListeners = function () {\n        for (var _i = 0, eventsArray_1 = eventsArray; _i < eventsArray_1.length; _i++) {\n            var eventName = eventsArray_1[_i];\n            eventEmitter.addListener(eventName, pushValue);\n        }\n    };\n    var removeEventListeners = function () {\n        for (var _i = 0, eventsArray_2 = eventsArray; _i < eventsArray_2.length; _i++) {\n            var eventName = eventsArray_2[_i];\n            eventEmitter.removeListener(eventName, pushValue);\n        }\n    };\n    addEventListeners();\n    return _a = {\n            next: function () {\n                return listening ? pullValue() : this.return();\n            },\n            return: function () {\n                emptyQueue();\n                return Promise.resolve({ value: undefined, done: true });\n            },\n            throw: function (error) {\n                emptyQueue();\n                return Promise.reject(error);\n            }\n        },\n        _a[iterall_1.$$asyncIterator] = function () {\n            return this;\n        },\n        _a;\n    var _a;\n}\nexports.eventEmitterAsyncIterator = eventEmitterAsyncIterator;\n//# sourceMappingURL=event-emitter-to-async-iterator.js.map"]},"metadata":{},"sourceType":"script"}